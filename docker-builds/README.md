[![Docker](https://img.shields.io/badge/Docker-2496ED?logo=docker&logoColor=black)](#)

## Multi-Stage Builds (Docker)

- The idea behind multi-stage builds is to keep our docker images lean, secure and production ready.
- I will use the Dockerfile I created for a simple project and improve it by using multi-stage builds
- The goal is to keep only what's neccessary to run our container eficiently

### Original Dockerfile vs Multi-Stage Dockerfile

```dockerfile
┌───────────────────────────────────────────────┬───────────────────────────────────────────────┐
│           Original Dockerfile                 │           Multi-Stage Dockerfile              │
├───────────────────────────────────────────────┼───────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │       FROM python:3.13-slim              │  │ │     FROM python:3.13-slim AS builder     │  │
│ └──────────────────────────────────────────┘  │ └──────────────────────────────────────────┘  │
│                    │                          │                    │                          │
│                    ▼                          │                    ▼                          │
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │              WORKDIR /app                │  │ │              WORKDIR /app                │  │
│ └──────────────────────────────────────────┘  │ └──────────────────────────────────────────┘  │
│                    │                          │                    │                          │
│                    ▼                          │                    ▼                          │
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │          COPY requirements.txt .         │  │ │          COPY requirements.txt .         │  │
│ └──────────────────────────────────────────┘  │ └──────────────────────────────────────────┘  │
│                    │                          │                    │                          │
│                    ▼                          │                    ▼                          │
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │ RUN pip install --no-cache-dir -r        │  │ │ RUN pip install --no-cache-dir --prefix= │  │
│ │ requirements.txt                         │  │ │ /install -r requirements.txt             │  │
│ └──────────────────────────────────────────┘  │ └──────────────────────────────────────────┘  │
│                    │                          │                    │                          │
│                    ▼                          │                    ▼                          │
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │              COPY devops/ .              │  │ │         FROM python:3.13-slim            │  │
│ └──────────────────────────────────────────┘  │ └──────────────────────────────────────────┘  │
│                    │                          │                    │                          │
│                    ▼                          │                    ▼                          │
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │               EXPOSE 8000                │  │ │              WORKDIR /app                │  │
│ └──────────────────────────────────────────┘  │ └──────────────────────────────────────────┘  │
│                    │                          │                    │                          │
│                    ▼                          │                    ▼                          │
│ ┌──────────────────────────────────────────┐  │ ┌──────────────────────────────────────────┐  │
│ │ CMD ["python", "manage.py",              │  │ │ COPY --from=builder /install /usr/local  │  │
│ │      "runserver", "0.0.0.0:8000"]        │  │ └──────────────────────────────────────────┘  │
│ └──────────────────────────────────────────┘  │                    │                          │
│                                               │                    ▼                          │
│                                               │ ┌──────────────────────────────────────────┐  │
│                                               │ │              COPY devops/ .              │  │
│                                               │ └──────────────────────────────────────────┘  │
│                                               │                    │                          │
│                                               │                    ▼                          │
│                                               │ ┌──────────────────────────────────────────┐  │
│                                               │ │               EXPOSE 8000                │  │
│                                               │ └──────────────────────────────────────────┘  │
│                                               │                    │                          │
│                                               │                    ▼                          │
│                                               │ ┌──────────────────────────────────────────┐  │
│                                               │ │ CMD ["python", "manage.py",              │  │
│                                               │ │      "runserver", "0.0.0.0:8000"]        │  │
│                                               │ └──────────────────────────────────────────┘  │
└───────────────────────────────────────────────┴───────────────────────────────────────────────┘
```